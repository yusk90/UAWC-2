_.mixin({capitalize:function(e){var t=e.split("-");return t.reduce(function(e,t){return e+t[0].toUpperCase()+t.slice(1)})},hyphen:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},isEmail:function(e){var t=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return t.test(e)},getCookieValue:function(e){var t,i=document.cookie.split("; ");return i.forEach(function(i){-1!==i.search(e)&&(t=i.replace(e+"=",""))}),t},deleteCookie:function(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}});var app={};!function(e){e.UserModel=Backbone.Model.extend({defaults:{userName:"",userEmail:"",userPassword:"",userCategory:"",themeConfig:null},validate:function(e){var t={};return e.userName||(t.userName="Введіть ім'я:"),e.userEmail?_.isEmail(e.userEmail)||(t.userEmail="Невалідний e-mail:"):t.userEmail="Введіть e-mail:",e.userPassword||(t.userPassword="Введіть пароль:"),"Категорія"===e.userCategory&&(t.userCategory="Виберіть категорію:"),_.isEmpty(t)?!1:t}})}(app),function(e){e.UsersCollection=Backbone.Collection.extend({model:e.UserModel,localStorage:new Backbone.LocalStorage("Users"),initialize:function(){this.fetch({reset:!0})}})}(app),function(e){e.BaseView=Backbone.View.extend({clearErrors:function(){this.$(".sidebar__error").remove()},showErrors:function(e,t){_.each(t,function(e,t){this.$("#"+_.hyphen(t)).before('<div class="sidebar__error">'+e+"</div>")},this)}})}(app),function(e){e.BaseWidgetView=e.BaseView.extend({baseInitialize:function(){this.editView=new e.EditWidgetView,this.listenTo(this.editView,"delete-widget",this.close).listenTo(this.editView,"edit-widget",this.edit),this.$el.on("contextmenu",this.preventRightClick),this.$el.on("mouseenter",this.addPadding),this.$el.on("mouseleave",this.deletePadding)},preventRightClick:function(){return!1},addPadding:function(){$(this).addClass("padding-on-hover")},deletePadding:function(){$(this).removeClass("padding-on-hover")},edit:function(){},close:function(){this.editView&&(this.editView.remove(),this.editView.unbind()),$(this).off(),this.remove(),this.unbind()}})}(app),function(e){e.EditWidgetView=e.BaseView.extend({tagName:"div",className:"hover",events:{"click .delete":"close"},template:'<i class="hover__full"></i><ul class="hover__buttons"><li class="hover__item edit"></li><li class="hover__item copy"></li><li class="hover__item delete"></li></ul>',render:function(){return this.$el.attr("contenteditable",!1),this.$el.html(this.template),this},close:function(){this.trigger("delete-widget")}})}(app),function(e){e.H1WidgetView=e.BaseWidgetView.extend({tagName:"h1",placeHolder:"Відредагуй заголовок просто натиснувши на текст правою кнопкою миші",initialize:function(){this.baseInitialize()},render:function(){return this.$el.attr("contenteditable",!0),this.$el.html(this.placeHolder),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.H2WidgetView=e.BaseWidgetView.extend({tagName:"h2",placeHolder:"Відредагуй підзаголовок просто натиснувши на текст правою кнопкою миші",initialize:function(){this.baseInitialize()},render:function(){return this.$el.attr("contenteditable",!0),this.$el.html(this.placeHolder),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.BlockquoteWidgetView=e.BaseWidgetView.extend({tagName:"blockquote",placeHolder:"Відредагуй цитату просто натиснувши на текст правою кнопкою миші",initialize:function(){this.baseInitialize()},render:function(){return this.$el.attr("contenteditable",!0),this.$el.html(this.placeHolder),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.ParagraphWidgetView=e.BaseWidgetView.extend({tagName:"p",placeHolder:"В цьому блоці опишіть детально, що Ви маєте на меті, яка Ваша ціль, заради чого Ви створюєте данну сторінку. Це краще дасть зрозуміти відвідувачам Вашої сторінки, яку мета ви поставили перед собою, і заради чого вони мають допомогти Вам.",initialize:function(){this.baseInitialize()},render:function(){return this.$el.attr("contenteditable",!0),this.$el.html(this.placeHolder),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.WellWidgetView=e.BaseWidgetView.extend({tagName:"p",className:"paragraph-block",placeHolder:"В цьому блоці опишіть детально, що Ви маєте на меті, яка Ваша ціль, заради чого Ви створюєте данну сторінку. Це краще дасть зрозуміти відвідувачам Вашої сторінки, яку мета ви поставили перед собою, і заради чого вони мають допомогти Вам.",initialize:function(){this.baseInitialize()},render:function(){return this.$el.attr("contenteditable",!0),this.$el.html(this.placeHolder),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.HrWidgetView=e.BaseWidgetView.extend({tagName:"hr",initialize:function(){this.baseInitialize()},render:function(){return this.$el.append(this.editView.render().el),this}})}(app),function(e){e.ImageWidgetView=e.BaseWidgetView.extend({tagName:"div",className:"image-block",events:{"click .edit":"changeImage"},initialize:function(){var e=$(document.createElement("img")),t=prompt("Введіть URL зображення","http://lorempixel.com/700/500");e.addClass("img-responsive image-block__picture"),e.attr("src",t),this.$el.append(e),this.baseInitialize()},render:function(){return this.$el.append(this.editView.render().el),this},changeImage:function(){this.$("img").attr("src",prompt("Введіть URL зображення","http://lorempixel.com/700/500"))}})}(app),function(e){e.ImageTextWidgetView=e.BaseWidgetView.extend({tagName:"figure",className:"image-block",events:{"click .edit":"changeImage"},placeHolder:"Текст до зображення",initialize:function(){var e=$(document.createElement("img")),t=$(document.createElement("figcaption"));e.addClass("img-responsive image-block__picture"),t.attr("contenteditable",!0),t.addClass("image-block__caption"),e.attr("src",prompt("Введіть URL зображення","http://lorempixel.com/700/500")),this.$el.append(e),this.$el.append(t.html(this.placeHolder)),this.baseInitialize()},render:function(){return this.$el.append(this.editView.render().el),this},changeImage:function(){this.$("img").attr("src",prompt("Введіть URL зображення","http://lorempixel.com/700/500"))}})}(app),function(e){e.GalleryWidgetView=e.BaseWidgetView.extend({})}(app),function(e){e.VideoWidgetView=e.BaseWidgetView.extend({tagName:"div",events:{"click .edit":"changeVideo"},defaultVideo:'<iframe width="560" height="315" src="https://www.youtube.com/embed/et8xNAc2ic8" frameborder="0" allowfullscreen></iframe>',initialize:function(){var e=prompt("Введіть код відео:",this.defaultVideo);this.$el.append(e),this.baseInitialize()},render:function(){return this.$el.append(this.editView.render().el),this},changeVideo:function(){this.attr("src",prompt("Введіть код відео:",this.defaultVideo))}})}(app),function(e){e.CounterWidgetView=e.BaseWidgetView.extend({tagName:"div",className:"update",template:'<div class="center__counter"><div class="center__process"></div><strong>73<sup>%</sup></strong></div>',initialize:function(){this.baseInitialize()},render:function(){return this.$el.html(this.template),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.ButtonWidgetView=e.BaseWidgetView.extend({tagName:"button",className:"center__button",buttonValue:"Допомогти",initialize:function(){this.baseInitialize()},render:function(){return this.$el.attr("contenteditable",!0),this.$el.html(this.buttonValue),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.SocialShareWidgetView=e.BaseWidgetView.extend({tagName:"div",elemHTML:'<script type="text/javascript" src="//yastatic.net/share/share.js" charset="utf-8"></script><div class="yashare-auto-init" data-yashareL10n="ru" data-yashareType="none" data-yashareQuickServices="vkontakte,facebook,twitter,odnoklassniki,moimir"></div>',initialize:function(){this.baseInitialize()},render:function(){return this.$el.html(this.elemHTML),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.SocialLikeWidgetView=e.BaseWidgetView.extend({tagName:"div",elemHTML:'<script type="text/javascript" src="//yastatic.net/share/share.js" charset="utf-8"></script><div class="yashare-auto-init" data-yashareL10n="ru" data-yashareType="small" data-yashareQuickServices="vkontakte,facebook,twitter,odnoklassniki,moimir" data-yashareTheme="counter"></div>',initialize:function(){this.baseInitialize()},render:function(){return this.$el.html(this.elemHTML),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.FooterWidgetView=e.BaseWidgetView.extend({tagName:"footer",placeHolder:"Це підвал - відредагувати можна просто натиснувши на текст правою кнопкою миші",initialize:function(){this.baseInitialize()},render:function(){return this.$el.attr("contenteditable",!0),this.$el.html(this.placeHolder),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.MapWidgetView=e.BaseWidgetView.extend({tagName:"div",events:{"click .edit":"changeMap"},defaultMap:'<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d387156.4344233849!2d-74.26055252223698!3d40.70349300078751!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c24fa5d33f083b%3A0xc80b8f06e177fe62!2z0J3RjNGOLdCZ0L7RgNC6LCDQodCo0JA!5e0!3m2!1sru!2sua!4v1445112839721" width="800" height="600" frameborder="0" style="border:0" allowfullscreen></iframe>',initialize:function(){var e=prompt("Введіть код карти:",this.defaultMap);this.$el.append(e),this.baseInitialize()},render:function(){return this.$el.append(this.editView.render().el),this},changeMap:function(){this.attr("src",prompt("Введіть код карти:",this.defaultMap))}})}(app),function(e){e.MenuWidgetView=e.BaseWidgetView.extend({tagName:"nav",className:"menu",initialize:function(){}})}(app),function(e){e.ContactsWidgetView=e.BaseWidgetView.extend({tagName:"div",elemHTML:"<ul><li>Адрес - 1</li><li>Адрес - 2</li><li>Телефон - </li></ul>",initialize:function(){this.baseInitialize()},render:function(){return this.$el.attr("contenteditable",!0),this.$el.html(this.elemHTML),this.$el.append(this.editView.render().el),this}})}(app),function(e){e.ConstructorView=e.BaseView.extend({el:"#constructor-widget",events:{click:"editElement"},template:_.template($("#theme-template").html()),initialize:function(){var t,i,n=e.users.findWhere({userEmail:_.getCookieValue("user")||localStorage.getItem("user")});this.$el.append(this.template(n.get("themeConfig"))),this.$("#constructor-row-1 > div > div").append((new e.H2WidgetView).render().el),this.$("#constructor-row-2 > div > div").each(function(t,i){$(i).append((new e.ParagraphWidgetView).render().el)}),this.$("#constructor-row-3 > div > div").each(function(t,i){$(i).append((new e.ParagraphWidgetView).render().el).append((new e.CounterWidgetView).render().el).append((new e.ButtonWidgetView).render().el)}),i=dragula([document.querySelector("#constructor-elements")],{copy:function(e,t){return"constructor-elements"===t.id}}),t=this.$("div").not(".row, .container"),t.each(function(e,t){i.containers.push(t)}),i.on("drop",function(t,i,n,a){var r=$(t),s=r.data("function");if("addH1"==s){var d=(new e.H1WidgetView).render().el;r.replaceWith(d)}if("addH2"==s){var l=(new e.H2WidgetView).render().el;r.replaceWith(l)}if("addBlockquote"==s){var o=(new e.BlockquoteWidgetView).render().el;r.replaceWith(o)}if("addParagraph"==s){var c=(new e.ParagraphWidgetView).render().el;r.replaceWith(c)}if("addWell"==s){var h=(new e.WellWidgetView).render().el;r.replaceWith(h)}if("addHr"==s){var p=(new e.HrWidgetView).render().el;r.replaceWith(p)}if("addImage"==s){var u=(new e.ImageWidgetView).render().el;r.replaceWith(u)}if("addImageWithText"==s){var m=(new e.ImageTextWidgetView).render().el;r.replaceWith(m)}if("addSocialLike"==s){var g=(new e.SocialLikeWidgetView).render().el;r.replaceWith(g)}if("addSocialShare"==s){var f=(new e.SocialShareWidgetView).render().el;r.replaceWith(f)}if("addFooter"==s){var w=(new e.FooterWidgetView).render().el;r.replaceWith(w)}if("addButton"==s){var V=(new e.ButtonWidgetView).render().el;r.replaceWith(V)}if("addCounter"==s){var v=(new e.CounterWidgetView).render().el;r.replaceWith(v)}if("addMap"==s){var W=(new e.MapWidgetView).render().el;r.replaceWith(W)}if("addVideo"==s){var b=(new e.VideoWidgetView).render().el;r.replaceWith(b)}if("addContacts"==s){var k=(new e.ContactsWidgetView).render().el;r.replaceWith(k)}})}})}(app),$(function(){app.users=new app.UsersCollection,document.querySelector("#registration-form")&&new app.RegistrationView,document.querySelector("#signin-form")&&new app.SigninView,document.querySelector("#themes-widget")&&new app.ThemesView,document.querySelector("#constructor-widget")&&new app.ConstructorView}),$(document).ready(function(){$(".template__design").click(function(){$(this).addClass("active"),$(".template__content").removeClass("active"),$(".elements").hide(),$(".settings").show()}),$(".template__content").click(function(){$(this).addClass("active"),$(".template__design").removeClass("active"),$(".settings").hide(),$(".elements").show()}),$(".design__title").click(function(){var e=$(this);e.parent().is(".open")?(e.parent().removeClass("open"),e.parent().find(".setting").slideUp()):(e.toggleClass("arrow"),e.parent().find(".setting").slideToggle())}),$(".dropdown__title").click(function(){var e=$(this);e.parent().is(".open")?(e.parent().removeClass("open"),e.parent().find(".interior").slideUp()):(e.toggleClass("arrow"),e.parent().find(".interior").slideToggle())})});