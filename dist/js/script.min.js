_.mixin({capitalize:function(e){var i=e.split("-");return i.reduce(function(e,i){return e+i[0].toUpperCase()+i.slice(1)})},hyphen:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},isEmail:function(e){var i=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return i.test(e)},getCookieValue:function(e){var i,t=document.cookie.split("; ");return t.forEach(function(t){-1!==t.search(e)&&(i=t.replace(e+"=",""))}),i},deleteCookie:function(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}});var app={};!function(e){e.UserModel=Backbone.Model.extend({defaults:{userName:"",userEmail:"",userPassword:"",userCategory:"",themeConfig:null},validate:function(e){var i={};return e.userName||(i.userName="Введіть ім'я:"),e.userEmail?_.isEmail(e.userEmail)||(i.userEmail="Невалідний e-mail:"):i.userEmail="Введіть e-mail:",e.userPassword||(i.userPassword="Введіть пароль:"),"Категорія"===e.userCategory&&(i.userCategory="Виберіть категорію:"),_.isEmpty(i)?!1:i}})}(app),function(e){e.UsersCollection=Backbone.Collection.extend({model:e.UserModel,localStorage:new Backbone.LocalStorage("Users"),initialize:function(){this.fetch({reset:!0})}})}(app),function(e){e.BaseView=Backbone.View.extend({clearErrors:function(){this.$(".sidebar__error").remove()},showErrors:function(e,i){_.each(i,function(e,i){this.$("#"+_.hyphen(i)).before('<div class="sidebar__error">'+e+"</div>")},this)}})}(app),function(e){e.RegistrationView=e.BaseView.extend({el:"#registration-form",events:{"click #submit-form":"submit"},initialize:function(){this.model=new e.UserModel,this.listenTo(this.model,"invalid",this.showErrors)},submit:function(i){function t(e){s[_.capitalize(e.id)]=e.value}var n=this.$(".sidebar__input"),s={},o=window.location.pathname;i.preventDefault(),this.clearErrors(),_.each(n,t,this),this.model.set(s),this.model.isValid()&&(this.stopListening(this.model),this.$("input.sidebar__input").val(""),e.users.create(this.model),this.$(".sidebar__submit").after('<div class="sidebar__success">Дякуємо за реєстрацію! Через 5 секунд Вас буде переадресовано на сторінку входу</div>'),setTimeout(function(){-1===window.location.pathname.indexOf("index.html")?window.location.pathname="sign-in.html":window.location.pathname=o.replace("index.html","sign-in.html")},5e3))}})}(app),function(e){e.SigninView=e.BaseView.extend({el:"#signin-form",events:{"click #submit-form":"validateUser"},initialize:function(){_.deleteCookie("user"),localStorage.removeItem("user")},validateUser:function(i){i.preventDefault();var t=this.$("#user-email").val(),n=this.$("#user-password").val(),s=e.users.findWhere({userEmail:t}),o={};this.clearErrors(),t?_.isEmail(t)?s||(o.userEmail="Такого e-mail не має в базі:"):o.userEmail="Введіть валідний e-mail:":o.userEmail="Введіть e-mail:",n?s&&n!==s.get("userPassword")&&(o.userPassword="Невірний пароль:"):o.userPassword="Введіть пароль:",_.isEmpty(o)?this.onSuccess(t):this.showErrors(null,o)},onSuccess:function(e){var i=window.location.pathname;document.cookie="user="+e,localStorage.setItem("user",e),window.location.pathname=i.replace("sign-in.html","theme.html")}})}(app),function(e){e.ThemesView=e.BaseView.extend({el:"#themes-widget",events:{"click .grids__block":"proceed"},proceed:function(i){function t(){function e(e,i){n["row"+(i+1)]=e}var t=$(i.currentTarget),n={};return _.each(t.data("theme-config").split("-"),e),n}i.preventDefault();var n=window.location.pathname,s=e.users.findWhere({userEmail:_.getCookieValue("user")||localStorage.getItem("user")});s.set("themeConfig",t()).save(),window.location.pathname=n.replace("theme.html","constructor.html")}})}(app),$(function(){app.users=new app.UsersCollection,document.querySelector("#registration-form")&&new app.RegistrationView,document.querySelector("#signin-form")&&new app.SigninView,document.querySelector("#themes-widget")&&new app.ThemesView,document.querySelector("#constructor-widget")&&new app.ConstructorView}),$(document).ready(function(){$(".template__design").click(function(){$(this).addClass("active"),$(".template__content").removeClass("active"),$(".elements").hide(),$(".settings").show()}),$(".template__content").click(function(){$(this).addClass("active"),$(".template__design").removeClass("active"),$(".settings").hide(),$(".elements").show()}),$(".design__title").click(function(){var e=$(this);e.parent().is(".open")?(e.parent().removeClass("open"),e.parent().find(".setting").slideUp()):(e.toggleClass("arrow"),e.parent().find(".setting").slideToggle())}),$(".dropdown__title").click(function(){var e=$(this);e.parent().is(".open")?(e.parent().removeClass("open"),e.parent().find(".interior").slideUp()):(e.toggleClass("arrow"),e.parent().find(".interior").slideToggle())})});